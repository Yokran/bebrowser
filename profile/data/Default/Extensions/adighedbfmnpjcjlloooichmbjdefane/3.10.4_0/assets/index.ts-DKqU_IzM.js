import{m as w,k as b,T,M as fe,w as me,c as _e}from"./_commonjsHelpers-DBcs7C3A.js";import{b as je,A as Ue,I as Re,h as Ne,g as qe,C as Ye,y as He,m as Ve,u as We,p as he,d as ge,P as De}from"./index-4Xml3FNN.js";import{e as Me,p as N,h as q}from"./const-DewCs8rR.js";function Je(u){const{hostMatch:t,extensionId:e,extensionName:n}=u;chrome.tabs.onUpdated.addListener(async(a,c,r)=>{if(r&&r.url&&r&&r.url&&c&&c.status==="loading"){const m=new URL(r.url).hostname;if(t.find(d=>!!~d.indexOf(m))){const d=chrome.runtime.getManifest();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:a,allFrames:!0},func:A=>{window[A.slug]=A},args:[{id:chrome.runtime.id,slug:e,extensionName:n,version:d.version,icons:d.icons,extensionFolderUri:chrome.runtime.getURL("/"),isProdMode:"update_url"in chrome.runtime.getManifest()}]})}}})}var Se=(u=>(u[u.FREE=0]="FREE",u[u.BASIC=1]="BASIC",u[u.PREMIUM=2]="PREMIUM",u))(Se||{});const Ke={type:"object",properties:{uid:{type:"string",default:""},email:{type:"string",default:""},stripeId:{type:"string",default:""},name:{type:"string",default:""},payments:{type:"array",items:{type:"object",properties:{},required:[],default:{}},default:[]},plan:{type:"string",default:Se.FREE},isSubscriptionActive:{type:"boolean",default:!1},lastCheckAt:{type:"number",default:0}},required:["uid","email","stripeId","name","payments","plan","isSubscriptionActive","lastCheckAt"],default:{}},Ge={type:"object",properties:{},required:[],default:{}},ze={type:"object",properties:{},required:[],default:{}},te={customerDataV2:Ke,features:Ge,persistLocalStorage:ze};function Ae(u,t){Object.keys(u).map(e=>t(u[e],e,u))}function ee(u,t){function e(c,r){switch(c.type){case"object":return n(c,r);case"array":return a(c,r);default:return r!==void 0?r:c.default!==void 0?c.default:void 0}}function n(c,r){const m={},d=c.properties??{};return Ae(d,(A,v)=>{if(c.required.includes(v)||r!==void 0&&r[v]!==void 0){let F=r!==void 0?r[v]:void 0;!A.properties&&A.default&&A.type==="object"&&A.additionalProperties&&(F=A.default),m[v]=e(A,F)}}),r&&Ae(r,(A,v)=>{m[v]===void 0&&A!==void 0&&(m[v]=A)}),m}function a(c,r){if(r===void 0)return c.default?c.default:void 0;const m=[];for(let d=0;d<r.length;d++)m.push(e(c.items??{},r[d]));return m}return e(t,u)}const se="__storage-local-version";function Ze(u){const t=Object.keys(u);chrome.runtime.onInstalled.addListener(n=>{(n.reason==="install"||n.reason==="update")&&e()});async function e(){let n=(await chrome.storage.local.get(se))[se];const a=chrome.runtime.getManifest().version;if(a!==n){const c=await chrome.storage.local.get(t),r=t.reduce((m,d)=>{let A=c[d]||{};return A=ee(A,u[d]),m[d]=A,m},{[se]:a});await chrome.storage.local.set(r)}}}function ue(u,t){async function e(r){let m;return await navigator.locks.request(G(r),{mode:"shared"},async()=>{m=(await pe(r))[r]}),m===void 0&&(m=ee(m,u[r])),m}async function n(r,m){await navigator.locks.request(G(r),{mode:"exclusive"},async()=>{let d=(await pe(r))[r];d===void 0&&(d=ee(d,u[r]));const A=await m(d);await chrome.storage.local.set({[r]:A})})}async function a(r,m){await navigator.locks.request(G(r),{mode:"exclusive"},async()=>{let d=m||{};m||(d=ee(d,u[r])),await chrome.storage.local.set({[r]:d})})}async function c(r){return await navigator.locks.request(G(r),{mode:"exclusive"},async()=>{await chrome.storage.local.remove([r])}),Promise.resolve()}return{updateBucket:n,setBucket:a,getBucket:e,deleteBucket:c}}function G(u){return`storage.local.${u}`}function pe(u){return new Promise(t=>{chrome.storage.local.get(u,e=>{t(e)})})}function Ie(){return Math.floor(new Date().getTime()/1e3)}function ye(u){return u+86400<Ie()}async function Xe(u){const t=await chrome.tabs.query({url:u.filter(e=>!~e.indexOf("esuit"))});for(let e of t)e.id&&await chrome.tabs.reload(e.id)}let z=[];const{updateBucket:Ce,getBucket:ae,deleteBucket:Be}=ue(te);function Qe(u){w("logout",async()=>{await Be("customerDataV2"),await Be("features")}),w("login",async()=>{const t=new URLSearchParams({[fe.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:`https://esuit.dev/login?${t}`,active:!0})}),w("closePopup",async()=>{chrome.extension.getViews({type:"popup"}).forEach(t=>{t.window.close()})}),w("openOptionsPage",async t=>{const e=chrome.runtime.getURL("src/pages/options/index.html"+(t?"#showSubscription=1":""));(await chrome.tabs.query({url:[e]})).forEach(n=>(n==null?void 0:n.id)&&chrome.tabs.remove(n.id)),await new Promise(n=>setTimeout(n,300)),await chrome.tabs.create({url:e,active:!0})}),w("getCustomerData",async()=>{const t=await ae("customerDataV2");if(t.uid)return ye(t.lastCheckAt)&&b("reFetchCustomerData"),t}),w("reFetchCustomerData",async(t=!1)=>{const e=await ae("customerDataV2"),n=e.uid;if(!n)return!1;if(!t&&n&&!ye(e.lastCheckAt))return!0;let a=null,c=null;try{const[d,A]=await Promise.all([fetch(`https://getusersubscription-57pphaecyq-uc.a.run.app/?token=${je(n,u.projectId)}`).then(v=>v.json()),et()]);if(d.stripeId&&(a=d),A){const v=A.find(F=>F.projectId===u.projectId);v&&(c=v)}}catch(d){return console.error(d),"Unknown error, please contact the developer."}if(!a||!c)return"ERROR: reFetchCustomerData returned undefined";let r=a.allPayments.filter(d=>Ue(d.status)||Re(d.status)||Ne(d.status)||qe(d.status)||Ye(d.status)),m=T.FREE;return be(r,c,T.BASIC)&&(m=T.BASIC),be(r,c,T.PREMIUM)&&(m=T.PREMIUM),await Ce("customerDataV2",async d=>a?{uid:n,stripeId:a.stripeId,email:a.email,name:a.name,payments:a.allPayments,plan:m,isSubscriptionActive:m!==T.FREE,lastCheckAt:Ie()}:d),b("rejectFeaturesToWindow"),!0}),w("visitPricingPage",async()=>{const t=`https://esuit.dev/pricing/${u.projectId}`,e=new URLSearchParams({[fe.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:t+`?${e}`,active:!0})}),w("visitDashboard",async()=>{await chrome.tabs.create({url:"https://esuit.dev/dashboard",active:!0}),b("closePopup")}),me("ifUserLogin",async()=>!!(await ae("customerDataV2")).uid),me("userInfoUpdate",async([t])=>{t&&(await Ce("customerDataV2",e=>(e.uid=t,e)),await b("reFetchCustomerData",!0),b("openOptionsPage",!0),setTimeout(()=>{Xe(u.hostMatch)},2e3))})}async function et(){if(z.length>0)return z;const u=await fetch("https://static-data.esuit.dev/index.json").then(t=>t.json());return z=He(u),z}function be(u,t,e){return!!u.find(n=>{if(![...Ve,...We,...he,...ge,...De].includes(n.status)||[...he].includes(n.status)&&(!n.nextBillingDate||n.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...ge].includes(n.status)&&(!n.nextBillingDate||n.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...De].includes(n.status)&&(!n.nextBillingDate||n.nextBillingDate<Math.ceil(new Date().getTime()/1e3)))return!1;const a=t.prices.find(c=>c.id===n.priceId);return!(!a||a.plan!==e)})}var tt=Object.defineProperty,ut=(u,t,e)=>t in u?tt(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,Z=(u,t,e)=>(ut(u,typeof t!="symbol"?t+"":t,e),e);class le{constructor(t,e){Z(this,"listeners",{}),Z(this,"tabs",[]),Z(this,"slug"),Z(this,"isDebugger"),this.slug=t,this.isDebugger=!!e,this.bindMessage(),this.bindEvent()}on(t,e){if(this.listeners[t])throw new Error(`event listener ${String(t)} already exist!`);return this.listeners[t]=e,()=>{delete this.listeners[t]}}async send(t,...e){this.isDebugger&&console.log("send message from background script",{action:t,payload:e,tabs:this.tabs});for(let n of this.tabs)try{const a=await chrome.tabs.get(n);a&&a.id?chrome.tabs.sendMessage(a.id,{from:this.slug,payload:{action:t,payload:e}}):this.deleteTabById(n)}catch(a){console.log(a),this.deleteTabById(n)}}bindMessage(){chrome.runtime.onMessageExternal.addListener((t,e,n)=>{var a,c;if((a=e==null?void 0:e.tab)!=null&&a.id){if(this.isDebugger&&console.log("received message from page",{request:t,sender:e}),t.action==="__connect")return this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),n();if(t.action==="__disconnect")return this.deleteTabById(e.tab.id),n();if(this.listeners[t.action])return(c=e==null?void 0:e.tab)!=null&&c.id?(this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),this.listeners[t.action](...t.payload).then(r=>{this.isDebugger&&console.log("send to callback from background",{request:t,sender:e,res:r}),n(r)}),!0):n();console.log(`unknown event ${t.action}`)}})}bindEvent(){chrome.tabs.onRemoved.addListener(t=>{this.deleteTabById(t)})}deleteTabById(t){if(this.tabs.includes(t)){const e=this.tabs.indexOf(t);this.tabs.splice(e,1)}}}function nt(u){return[T.FREE,T.BASIC,T.PREMIUM].indexOf(u)}function rt(u,t){const e=nt(t);return u.limitation?u.limitation[e]:0}function Ee(u,t){return{[T.FREE]:1,[T.BASIC]:10,[T.PREMIUM]:100}[t]>=u.permission}function ie(u,t){return u.map(e=>{t[e.key]?(t[e.key].enable=t[e.key].enable??e.defaultEnable,t[e.key].currentFreeTryCount=t[e.key].currentFreeTryCount??0):t[e.key]={enable:e.defaultEnable,currentFreeTryCount:0}}),t}function st(u){const{cacheId:t,defaultMemoConfig:e}=u;w("setUIMemoSettings",async n=>{await chrome.storage.local.set({[t]:n})}),w("getUIMemoSettings",async()=>{const n=await b("getFeaturesDataByPlan");let a=await new Promise(c=>{chrome.storage.local.get([t]).then(r=>{r[t]?c(r[t]):c(!1)})});return a||(a={...e}),Object.keys(a).map(c=>{const r=Object.values(n).find(d=>d._.memoKey===c);if(r&&r.needUpgrade&&(!r.enable||!(r.freeTryLeft>0||r.limitation>0)&&e[c]!==void 0))return m();function m(){a[c]=e[c]}}),{...e,...a}})}let Te=!1;function at(){return Te}function it(){Te=!0}const{updateBucket:oe,getBucket:we}=ue(te);function ot(u){if(at())return;it();const t=new le(u,!0);return w("getAllPersistLocalStorage",()=>we("persistLocalStorage")),w("setPersistLocalStorage",async(e,n)=>{await oe("persistLocalStorage",a=>{try{n=JSON.stringify(n)}catch{}return a[e]=n,a})}),w("getPersistLocalStorage",async(e,n)=>{const a=await we("persistLocalStorage");if(a[e]){try{return JSON.parse(a[e])}catch{}return a[e]}return n??void 0}),w("clearPersistLocalStorage",async()=>{oe("persistLocalStorage",()=>({}))}),w("removePersistLocalStorage",async e=>{oe("persistLocalStorage",n=>(delete n[e],n))}),t.on("getAllPersistLocalStorage",()=>b("getAllPersistLocalStorage")),t.on("setPersistLocalStorage",(...e)=>b("setPersistLocalStorage",...e)),t.on("getPersistLocalStorage",(...e)=>b("getPersistLocalStorage",...e)),t.on("clearPersistLocalStorage",()=>b("clearPersistLocalStorage")),void t.on("removePersistLocalStorage",e=>b("removePersistLocalStorage",e))}const{setBucket:ve,getBucket:ce}=ue(te);function ct(u){const{projectId:t,hostMatch:e,cacheId:n,features:a,defaultMemoConfig:c}=u,r=new le(t,!0);return ot(u.projectId),st({cacheId:n,defaultMemoConfig:c}),chrome.tabs.onUpdated.addListener(async(F,B,h)=>{if(h&&h.url&&B.status==="loading"){const C=new URL(h.url).hostname;e.find(O=>!!~O.indexOf(C))&&d(F)}}),chrome.storage.onChanged.addListener((F,B)=>{B==="local"&&F&&F.features&&m()}),w("rejectFeaturesToWindow",async()=>{m()}),w("getFeature",async F=>A()[F]),w("consumeFeaturesTreeTryByMemoUIConfigs",async F=>{const B=await A();let h=[];Object.entries(F).map(([C,O])=>{if(c[C]!==void 0&&c[C]!==O){const k=Object.values(B).find(L=>L._.memoKey===C);k&&k.isCanFreeTry&&h.push(k._.key)}}),h.length>0&&b("consumeFeatureTreeTry",h)}),w("consumeFeatureTreeTry",async F=>{let B=ie(a,await ce("features"));const h=await v();let C=!1;F.map(O=>{const k=a.find(L=>L.key===O||L.memoKey===O);k&&(Ee(k,h)||(B[k.key].currentFreeTryCount++,C=!0))}),C&&await ve("features",B)}),w("saveFeaturesEnables",async F=>{let B=ie(a,await ce("features"));Object.entries(F).map(([h,C])=>{B[h].enable=C}),await ve("features",B)}),w("getFeaturesDataByPlan",A),r.on("getUIMemoSettings",()=>b("getUIMemoSettings")),r.on("setUIMemoSettings",F=>b("setUIMemoSettings",F)),r.on("consumeFeatureTreeTry",F=>b("consumeFeatureTreeTry",F)),r.on("visitPricingPage",()=>b("visitPricingPage")),void r.on("consumeFeaturesTreeTryByMemoUIConfigs",F=>{b("consumeFeaturesTreeTryByMemoUIConfigs",F)});async function m(){const F=await chrome.tabs.query({url:e});F&&F.map(B=>{B&&B.id&&d(B.id)})}async function d(F){const B=await A();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:F,allFrames:!0},func:(h,C)=>{window[C]=JSON.parse(h)},args:[JSON.stringify(B),`${t.replaceAll("-","_")}`]})}async function A(){const F=await v();let B=ie(a,await ce("features"));return a.map(h=>{var C;const O=Ee(h,F);let k,L=0;return h.memoKey&&(k=c[h.memoKey]),h.maxFreeTryCount&&B[h.key].currentFreeTryCount!==void 0&&(L=Math.max(0,h.maxFreeTryCount-B[h.key].currentFreeTryCount)),{enable:((C=B[h.key])==null?void 0:C.enable)??h.defaultEnable,needUpgrade:!O,limitation:rt(h,F),permission:h.permission,freeTryLeft:h.maxFreeTryCount?L:0,isCanFreeTry:!!h.maxFreeTryCount&&h.maxFreeTryCount>0,defaultValue:k,_:h}}).reduce((h,C)=>(h[C._.key]=C,h),{})}async function v(){const F=await b("getCustomerData");return F?F.plan:T.FREE}}function lt(u,t){(async()=>{let e=0,n=(await chrome.declarativeNetRequest.getDynamicRules()).map(c=>c.id);const a=u.map((c,r)=>(e=r+1,{id:e,priority:1,action:{type:"modifyHeaders",responseHeaders:[{header:"Content-Security-Policy",operation:"remove"},{header:"Content-Security-Policy-Report-Only",operation:"remove"}]},condition:{regexFilter:c,resourceTypes:["main_frame","xmlhttprequest"]}}));await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:n,addRules:a})})()}function dt(u){const t=new le(u,!0);t.on("reFetchCustomerData",e=>b("reFetchCustomerData",e)),t.on("visitDashboard",()=>b("visitDashboard")),t.on("getCustomerData",()=>b("getCustomerData")),t.on("logout",()=>b("logout")),t.on("login",()=>b("login"))}function Ft(u){Ze(te),Qe(u),dt(u.projectId)}let ft=/[\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g,mt=/[\?<>\\:\*\|":]/g,ht=/[\x00-\x1f\x80-\x9f]/g,gt=/^\.+$/,Dt=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,At=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function pt(u){return u.trim().replace(At,"").replace(mt,"").replace(ft,"").replace(/[\\/]/g,"").replace(ht,"").replace(gt,"").replace(Dt,"").replaceAll(". ᴥ","").replace(/\s+/g," ").trim().split("").splice(0,255).join("").replaceAll("~","").replaceAll("  "," ").replaceAll("..","").trim()}function yt(u){return(t=pt,e=u,t(e)).replaceAll(".","");var t,e}var ke=(u=>(u.BOTH="both",u.VIDEOS_ONLY="VideosOnly",u.IMAGES_ONLY="ImagesOnly",u))(ke||{}),xe=(u=>(u.ORIGINAL="none",u.PNG="image/png",u.JPG="image/jpeg",u.WEBP="image/webp",u))(xe||{}),Oe=(u=>(u[u.ALL=0]="ALL",u[u.BY_PHOTOS_COUNT=1]="BY_PHOTOS_COUNT",u[u.BY_DAYS_COUNT=2]="BY_DAYS_COUNT",u))(Oe||{}),Ct={exports:{}};(function(u,t){(function(e,n){u.exports=n()})(_e,function(){var e=1e3,n=6e4,a=36e5,c="millisecond",r="second",m="minute",d="hour",A="day",v="week",F="month",B="quarter",h="year",C="date",O="Invalid Date",k=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,L=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Le={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(f){var o=["th","st","nd","rd"],s=f%100;return"["+f+(o[(s-20)%10]||o[s]||o[0])+"]"}},ne=function(f,o,s){var l=String(f);return!l||l.length>=o?f:""+Array(o+1-l.length).join(s)+f},Pe={s:ne,z:function(f){var o=-f.utcOffset(),s=Math.abs(o),l=Math.floor(s/60),i=s%60;return(o<=0?"+":"-")+ne(l,2,"0")+":"+ne(i,2,"0")},m:function f(o,s){if(o.date()<s.date())return-f(s,o);var l=12*(s.year()-o.year())+(s.month()-o.month()),i=o.clone().add(l,F),g=s-i<0,D=o.clone().add(l+(g?-1:1),F);return+(-(l+(s-i)/(g?i-D:D-i))||0)},a:function(f){return f<0?Math.ceil(f)||0:Math.floor(f)},p:function(f){return{M:F,y:h,w:v,d:A,D:C,h:d,m,s:r,ms:c,Q:B}[f]||String(f||"").toLowerCase().replace(/s$/,"")},u:function(f){return f===void 0}},Y="en",_={};_[Y]=Le;var de="$isDayjsObject",re=function(f){return f instanceof J||!(!f||!f[de])},W=function f(o,s,l){var i;if(!o)return Y;if(typeof o=="string"){var g=o.toLowerCase();_[g]&&(i=g),s&&(_[g]=s,i=g);var D=o.split("-");if(!i&&D.length>1)return f(D[0])}else{var y=o.name;_[y]=o,i=y}return!l&&i&&(Y=i),i||!l&&Y},$=function(f,o){if(re(f))return f.clone();var s=typeof o=="object"?o:{};return s.date=f,s.args=arguments,new J(s)},p=Pe;p.l=W,p.i=re,p.w=function(f,o){return $(f,{locale:o.$L,utc:o.$u,x:o.$x,$offset:o.$offset})};var J=function(){function f(s){this.$L=W(s.locale,null,!0),this.parse(s),this.$x=this.$x||s.x||{},this[de]=!0}var o=f.prototype;return o.parse=function(s){this.$d=function(l){var i=l.date,g=l.utc;if(i===null)return new Date(NaN);if(p.u(i))return new Date;if(i instanceof Date)return new Date(i);if(typeof i=="string"&&!/Z$/i.test(i)){var D=i.match(k);if(D){var y=D[2]-1||0,E=(D[7]||"0").substring(0,3);return g?new Date(Date.UTC(D[1],y,D[3]||1,D[4]||0,D[5]||0,D[6]||0,E)):new Date(D[1],y,D[3]||1,D[4]||0,D[5]||0,D[6]||0,E)}}return new Date(i)}(s),this.init()},o.init=function(){var s=this.$d;this.$y=s.getFullYear(),this.$M=s.getMonth(),this.$D=s.getDate(),this.$W=s.getDay(),this.$H=s.getHours(),this.$m=s.getMinutes(),this.$s=s.getSeconds(),this.$ms=s.getMilliseconds()},o.$utils=function(){return p},o.isValid=function(){return this.$d.toString()!==O},o.isSame=function(s,l){var i=$(s);return this.startOf(l)<=i&&i<=this.endOf(l)},o.isAfter=function(s,l){return $(s)<this.startOf(l)},o.isBefore=function(s,l){return this.endOf(l)<$(s)},o.$g=function(s,l,i){return p.u(s)?this[l]:this.set(i,s)},o.unix=function(){return Math.floor(this.valueOf()/1e3)},o.valueOf=function(){return this.$d.getTime()},o.startOf=function(s,l){var i=this,g=!!p.u(l)||l,D=p.p(s),y=function(U,I){var P=p.w(i.$u?Date.UTC(i.$y,I,U):new Date(i.$y,I,U),i);return g?P:P.endOf(A)},E=function(U,I){return p.w(i.toDate()[U].apply(i.toDate("s"),(g?[0,0,0,0]:[23,59,59,999]).slice(I)),i)},M=this.$W,S=this.$M,x=this.$D,R="set"+(this.$u?"UTC":"");switch(D){case h:return g?y(1,0):y(31,11);case F:return g?y(1,S):y(0,S+1);case v:var j=this.$locale().weekStart||0,H=(M<j?M+7:M)-j;return y(g?x-H:x+(6-H),S);case A:case C:return E(R+"Hours",0);case d:return E(R+"Minutes",1);case m:return E(R+"Seconds",2);case r:return E(R+"Milliseconds",3);default:return this.clone()}},o.endOf=function(s){return this.startOf(s,!1)},o.$set=function(s,l){var i,g=p.p(s),D="set"+(this.$u?"UTC":""),y=(i={},i[A]=D+"Date",i[C]=D+"Date",i[F]=D+"Month",i[h]=D+"FullYear",i[d]=D+"Hours",i[m]=D+"Minutes",i[r]=D+"Seconds",i[c]=D+"Milliseconds",i)[g],E=g===A?this.$D+(l-this.$W):l;if(g===F||g===h){var M=this.clone().set(C,1);M.$d[y](E),M.init(),this.$d=M.set(C,Math.min(this.$D,M.daysInMonth())).$d}else y&&this.$d[y](E);return this.init(),this},o.set=function(s,l){return this.clone().$set(s,l)},o.get=function(s){return this[p.p(s)]()},o.add=function(s,l){var i,g=this;s=Number(s);var D=p.p(l),y=function(S){var x=$(g);return p.w(x.date(x.date()+Math.round(S*s)),g)};if(D===F)return this.set(F,this.$M+s);if(D===h)return this.set(h,this.$y+s);if(D===A)return y(1);if(D===v)return y(7);var E=(i={},i[m]=n,i[d]=a,i[r]=e,i)[D]||1,M=this.$d.getTime()+s*E;return p.w(M,this)},o.subtract=function(s,l){return this.add(-1*s,l)},o.format=function(s){var l=this,i=this.$locale();if(!this.isValid())return i.invalidDate||O;var g=s||"YYYY-MM-DDTHH:mm:ssZ",D=p.z(this),y=this.$H,E=this.$m,M=this.$M,S=i.weekdays,x=i.months,R=i.meridiem,j=function(I,P,V,K){return I&&(I[P]||I(l,g))||V[P].slice(0,K)},H=function(I){return p.s(y%12||12,I,"0")},U=R||function(I,P,V){var K=I<12?"AM":"PM";return V?K.toLowerCase():K};return g.replace(L,function(I,P){return P||function(V){switch(V){case"YY":return String(l.$y).slice(-2);case"YYYY":return p.s(l.$y,4,"0");case"M":return M+1;case"MM":return p.s(M+1,2,"0");case"MMM":return j(i.monthsShort,M,x,3);case"MMMM":return j(x,M);case"D":return l.$D;case"DD":return p.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return j(i.weekdaysMin,l.$W,S,2);case"ddd":return j(i.weekdaysShort,l.$W,S,3);case"dddd":return S[l.$W];case"H":return String(y);case"HH":return p.s(y,2,"0");case"h":return H(1);case"hh":return H(2);case"a":return U(y,E,!0);case"A":return U(y,E,!1);case"m":return String(E);case"mm":return p.s(E,2,"0");case"s":return String(l.$s);case"ss":return p.s(l.$s,2,"0");case"SSS":return p.s(l.$ms,3,"0");case"Z":return D}return null}(I)||D.replace(":","")})},o.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},o.diff=function(s,l,i){var g,D=this,y=p.p(l),E=$(s),M=(E.utcOffset()-this.utcOffset())*n,S=this-E,x=function(){return p.m(D,E)};switch(y){case h:g=x()/12;break;case F:g=x();break;case B:g=x()/3;break;case v:g=(S-M)/6048e5;break;case A:g=(S-M)/864e5;break;case d:g=S/a;break;case m:g=S/n;break;case r:g=S/e;break;default:g=S}return i?g:p.a(g)},o.daysInMonth=function(){return this.endOf(F).$D},o.$locale=function(){return _[this.$L]},o.locale=function(s,l){if(!s)return this.$L;var i=this.clone(),g=W(s,l,!0);return g&&(i.$L=g),i},o.clone=function(){return p.w(this.$d,this)},o.toDate=function(){return new Date(this.valueOf())},o.toJSON=function(){return this.isValid()?this.toISOString():null},o.toISOString=function(){return this.$d.toISOString()},o.toString=function(){return this.$d.toUTCString()},f}(),Fe=J.prototype;return $.prototype=Fe,[["$ms",c],["$s",r],["$m",m],["$H",d],["$W",A],["$M",F],["$y",h],["$D",C]].forEach(function(f){Fe[f[1]]=function(o){return this.$g(o,f[0],f[1])}}),$.extend=function(f,o){return f.$i||(f(o,J,$),f.$i=!0),$},$.locale=W,$.isDayjs=re,$.unix=function(f){return $(1e3*f)},$.en=_[Y],$.Ls=_,$.p={},$})})(Ct);const Bt=[{key:"imageFormats",name:"image formats",permission:10,defaultEnable:!0,limitation:[50,0,0],memoKey:"formatType"},{key:"filenameRule",name:"filename rule",permission:10,limitation:[50,0,0],defaultEnable:!0,memoKey:"filenameFormats"},{key:"resumeDownloading",name:"resume downloading",permission:10,defaultEnable:!0,memoKey:null},{key:"skipDownloadedFiles",name:"skip downloaded file",permission:10,defaultEnable:!0,maxFreeTryCount:5,memoKey:"isSkipDownloadedFile"}],bt=["-**original name**-","-**index**-_-**date**-","-**date**-","-**short code**-_-**date**-","-**timestamp**-","-**user display name**-_-**date**-","-**file id**-_-**date**-","-**username code**-_-**timestamp**-"],Et={isFullSpeed:!1,isSkipDownloadedFile:!1,isDownloadVideoThumbnail:!1,isGenFolder:!1,isSplitFolder:!1,downloadType:ke.BOTH,formatType:xe.ORIGINAL,filenameFormats:bt[0],requestDelay:0,fetchingCountType:Oe.ALL,fetchingCountByPhotosCountValue:10,fetchingCountByPhotosDaysValue:3};var wt=Object.defineProperty,vt=(u,t,e)=>t in u?wt(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,X=(u,t,e)=>(vt(u,typeof t!="symbol"?t+"":t,e),e);class $t{constructor(t,e){X(this,"listeners",{}),X(this,"tabs",[]),X(this,"slug"),X(this,"isDebugger"),this.slug=t,this.isDebugger=!!e,this.bindMessage(),this.bindEvent()}on(t,e){if(this.listeners[t])throw new Error(`event listener ${String(t)} already exist!`);return this.listeners[t]=e,()=>{delete this.listeners[t]}}async send(t,...e){this.isDebugger&&console.log("send message from background script",{action:t,payload:e,tabs:this.tabs});for(let n of this.tabs)try{const a=await chrome.tabs.get(n);a&&a.id?chrome.tabs.sendMessage(a.id,{from:this.slug,payload:{action:t,payload:e}}):this.deleteTabById(n)}catch(a){console.log(a),this.deleteTabById(n)}}bindMessage(){chrome.runtime.onMessageExternal.addListener((t,e,n)=>{var a,c;if((a=e==null?void 0:e.tab)!=null&&a.id){if(this.isDebugger&&console.log("received message from page",{request:t,sender:e}),t.action==="__connect")return this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),n();if(t.action==="__disconnect")return this.deleteTabById(e.tab.id),n();if(this.listeners[t.action])return(c=e==null?void 0:e.tab)!=null&&c.id?(this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),this.listeners[t.action](...t.payload).then(r=>{this.isDebugger&&console.log("send to callback from background",{request:t,sender:e,res:r}),n(r)}),!0):n();console.log(`unknown event ${t.action}`)}})}bindEvent(){chrome.tabs.onRemoved.addListener(t=>{this.deleteTabById(t)})}deleteTabById(t){if(this.tabs.includes(t)){const e=this.tabs.indexOf(t);this.tabs.splice(e,1)}}}function Mt(){return Math.floor(new Date().getTime()/1e3)}function St(u){u.on("downloadFileByUri",async(t,e,n)=>{const a=[yt(Me),e].join("/");await chrome.downloads.download({filename:a,url:t,conflictAction:"overwrite",saveAs:!1})})}const It={type:"array",items:{},default:[]},Tt={type:"array",items:{type:"object",properties:{collectionToken:{type:"string",default:""},lastCursor:{type:"string",default:""},lastIndex:{type:"number",default:0},lastUpdateAt:{type:"number",default:0}},required:["collectionToken","lastCursor","lastIndex","lastUpdateAt"]},default:[]},kt={resumeCursor:Tt,downloadedFilesId:It},{updateBucket:Q,setBucket:jt,getBucket:$e,deleteBucket:Ut}=ue(kt);function xt(){const u=new $t(N,Ot());St(u),u.on("visitPricing",async()=>{b("visitPricingPage")}),u.on("clearDownloadedFilesId",()=>{Q("downloadedFilesId",()=>[])}),u.on("getDownloadedFilesId",()=>$e("downloadedFilesId")),u.on("appendDownloadedFilesId",t=>{Q("downloadedFilesId",e=>e.length>3e5?[]:(e.push(...t),e))}),u.on("setResumeCursor",async t=>{t.collectionToken&&await Q("resumeCursor",e=>{const n=e.findIndex(r=>r.collectionToken===t.collectionToken),a=Mt(),c={...t,lastUpdateAt:a};return~n?e[n]=c:e.push(c),e})}),u.on("getResumeCursor",t=>new Promise(async e=>{const a=(await $e("resumeCursor")).find(c=>c.collectionToken===t);e(a??null)})),u.on("removeResumeCursor",async t=>{await Q("resumeCursor",e=>{const n=e.findIndex(a=>a.collectionToken===t);return~n&&e.splice(n,1),e})})}function Ot(){return!("update_url"in chrome.runtime.getManifest())}lt(q);xt();Je({hostMatch:q,extensionId:N,extensionName:Me});Ft({projectId:N,callbackExtId:chrome.runtime.id,hostMatch:q});ct({projectId:N,hostMatch:q,cacheId:"app-3.0.0",features:Bt,defaultMemoConfig:Et});chrome.scripting.registerContentScripts([{id:`inject-${N}`,js:["injects/proxy.js"],css:["injects/style.css"],matches:q,runAt:"document_start",world:"MAIN"}]);chrome.scripting.registerContentScripts([{id:`inject-${N}-module`,js:["injects/vendors.js","injects/index.js"],matches:q,runAt:"document_end",world:"MAIN"}]);
