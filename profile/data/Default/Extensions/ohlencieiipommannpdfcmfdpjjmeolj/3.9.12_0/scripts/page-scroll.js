(()=>{"use strict";var e=function(e){return e.OpenPrintFriendly="openPrintfriendly",e.StartCaptureFullPage="startCaptureFullPage",e.CaptureCurrentView="captureCurrentView",e.ContinueCaptureFullPage="continueCaptureFullPage",e.EndCaptureFullPage="endCaptureFullPage",e.CancelCaptureFullPage="cancelCaptureFullPage",e.ScrollPage="scrollPage",e.ConfigureDefaultButton="configureDefaultButton",e}({}),t=function(e){return e.SettingsTextSize="printfriendly_settings_text_size",e.SettingsImageSize="printfriendly_settings_img_size",e.ScreenshotImages="printfriendly_screenshot_images",e.SettingsScreenshotBanner="printfriendly_settings_screenshot_banner",e.SettingsDefaultMode="printfriendly_settings_default_mode",e.SettingsPaperSize="printfriendly_settings_paper_size",e.SettingsScreenshotFormat="printfriendly_settings_screenshot_format",e.SettingsLanguage="printfriendly_settings_language",e.PopupWindowId="printfriendly_popup_window_id",e.ScreenshotTabId="printfriendly_screenshot_tab_id",e.ScreenshotCapturing="printfriendly_screenshot_capturing",e.ScreenshotImage="printfriendly_screenshot_img",e.ScreenshotSlices="printfriendly_screenshot_slices",e.WebsiteHostname="printfriendly_website_hostname",e.WebsiteUrl="printfriendly_website_url",e.WebsiteTitle="printfriendly_website_title",e.AlreadyShownIntro="alreadyShownIntro",e.ClientId="printfriendly_client_id",e.ScreenshotProgress="printfriendly_screenshot_progress",e.ScreenshotFilename="printfriendly_screenshot_filename",e.PrintInTabPayload="printfriendly_print_in_tab_payload",e}({});function i(e){return new Promise((t=>{const i=setTimeout((()=>{clearTimeout(i),t()}),e)}))}class n{disable(){window.addEventListener&&(window.addEventListener("DOMMouseScroll",o,{passive:!1}),window.addEventListener("wheel",o,{passive:!1})),document.onkeydown=l}enable(){window.removeEventListener&&(window.removeEventListener("DOMMouseScroll",o),window.removeEventListener("wheel",o)),document.onkeydown=null}getWidth(){let e=18;try{const t=document.createElement("p");t.style.width="100%",t.style.height="200px",t.style.display="block";const i=document.createElement("div");i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.style.visibility="hidden",i.style.width="200px",i.style.height="150px",i.style.overflow="hidden",i.appendChild(t),document.body.appendChild(i);const n=t.offsetWidth;i.style.overflow="scroll";let o=t.offsetWidth;n===o&&(o=i.clientWidth),document.body.removeChild(i),e=n-o}catch(t){return e}return e}}function o(e){e.preventDefault()}function l(e){if({ArrowLeft:!0,ArrowUp:!0,ArrowRight:!0,ArrowDown:!0}[e.key])return o(e),!1}function s(e,t){e.style.display=t?"block":"none"}function r(e,t){e.style.visibility=t?"":"hidden"}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class d{calcAdditionalTotalHeight(){this.additonalTotalHeight=0;const e=document.querySelector("div.isolate:has(.text-base)"),t=document.querySelector("div.draggable.no-draggable-children.sticky.top-0");e&&(this.additonalTotalHeight+=e.clientHeight),t&&(this.additonalTotalHeight+=t.clientHeight)}calcAdditionalYOffset(){this.additonalYOffset=0;const e=document.querySelector("div.draggable.no-draggable-children.sticky.top-0");e&&(this.additonalYOffset+=e.clientHeight)}modifyScreen(e){const t=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){a(e,t,i[t])}))}return e}({},e);return t.y-=this.additonalYOffset,t.totalHeight+=this.additonalTotalHeight,t.yOffset=this.additonalYOffset,t}onStartScrolling(){this.hideNavPanel(),this.hideScrollbars()}onLastFrame(){this.hideNavPanel(!1),this.hideChatHistory(!1),this.hideTopPanel(!1),this.hideTopNavPanel(!1)}onEachFrame(){this.hideScrollButton()}onFirstFrame(){this.hideTopPanel(),this.hideTopNavPanel(),this.hideNavPanel(!1),this.hideAskGPTPanel(!1),this.hideChatHistory()}onEachFrameAfterFirst(){this.hideAskGPTPanel(),this.hideNavPanel(),this.hideScrollButton(),this.hidePlanPanel(),this.hideHelpButton()}onNextEachFrame(){this.hideScrollButton()}onEndScrolling(){this.hideTopPanel(!1),this.hideAskGPTPanel(!1),this.hideNavPanel(!1),this.hideChatHistory(!1),this.hideScrollButton(!1),this.hideScrollbars(!1),this.hidePlanPanel(!1),this.hideHelpButton(!1)}hideAskGPTPanel(e=!0){const t=document.querySelector("div.isolate:has(.text-base)");t&&s(t,!e)}hideNavPanel(e=!0){const t=document.querySelector("nav");t&&r(t,!e)}hideTopPanel(e=!0){const t=document.querySelector("div.draggable.no-draggable-children.sticky.top-0");t&&s(t,!e)}hideTopNavPanel(e=!0){const t=document.querySelector("nav > div.flex");t&&r(t,!e)}hideChatHistory(e=!0){const t=document.querySelector("nav > div.flex-col");t&&r(t,!e)}hideScrollButton(e=!0){const t=document.querySelector("button.cursor-pointer.rounded-full");t&&s(t,!e)}hideScrollbars(e=!0){const t=document.querySelectorAll("div.overflow-y-auto.flex-col");for(const i of t)i.style.overflow=e?"hidden":"auto"}hidePlanPanel(e=!0){const t=document.querySelector("nav div.flex.flex-col.py-2");t&&r(t,!e)}hideHelpButton(e=!0){const t=document.querySelector('button[aria-haspopup="menu"].flex.h-6');t&&s(t,!e)}constructor(){a(this,"additonalTotalHeight",void 0),a(this,"additonalYOffset",void 0),this.additonalTotalHeight=0,this.additonalYOffset=0}}class c{calcAdditionalTotalHeight(){}calcAdditionalYOffset(){}modifyScreen(e){return e}onStartScrolling(){this.hideFixedElements()}onLastFrame(){this.restoreFixedElements(),this.hideBottomFixedElements()}onEachFrame(){this.hideFixedElements()}onFirstFrame(){this.hideBottomFixedElements(!1)}onEachFrameAfterFirst(){this.hideBottomFixedElements()}onNextEachFrame(){this.hideFixedElements()}onEndScrolling(){this.restoreFixedElements()}hideFixedElements(){const e=document.querySelectorAll("*");this.fixedElements=[];for(const t of e){const e=window.getComputedStyle(t);if("fixed"===e.position||"sticky"===e.position){const i=parseInt(e.height,10),n=parseInt(e.width,10);if(i<window.innerHeight||n<window.innerWidth){this.fixedElements.push(t);const e=t.querySelectorAll("*");for(const t of e)r(t,!1);r(t,!1)}}}}restoreFixedElements(){for(const e of this.fixedElements){r(e,!0);const t=e.querySelectorAll("*");for(const e of t)r(e,!0)}}hideBottomFixedElements(e=!0){const t=document.querySelectorAll("*");for(const i of t){const t=window.getComputedStyle(i),n="fixed"===t.position||"sticky"===t.position,o=parseInt(t.bottom,10),l=0===o||o<30,s=parseInt(t.height,10),a=parseInt(t.width,10),d=s<window.innerHeight&&a<window.innerWidth;n&&l&&d&&r(i,!e)}}constructor(){var e,t;t=void 0,(e="fixedElements")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t,this.fixedElements=[]}}class h{calcAdditionalTotalHeight(){this.domActions.calcAdditionalTotalHeight()}calcAdditionalYOffset(){this.domActions.calcAdditionalYOffset()}modifyScreen(e){return this.domActions.modifyScreen(e)}onStartScrolling(){this.domActions.onStartScrolling()}onLastFrame(){this.domActions.onLastFrame()}onEachFrame(){this.domActions.onEachFrame()}onFirstFrame(){this.domActions.onFirstFrame()}onEachFrameAfterFirst(){this.domActions.onEachFrameAfterFirst()}onNextEachFrame(){this.domActions.onNextEachFrame()}onEndScrolling(){this.domActions.onEndScrolling()}constructor(){var e,t;t=void 0,(e="domActions")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t;const i=window.location.host;this.domActions="chatgpt.com"===i?new d:new c}}function m(e,t,i,n,o,l,s){try{var r=e[l](s),a=r.value}catch(e){return void i(e)}r.done?t(a):Promise.resolve(a).then(n,o)}function u(e){return function(){var t=this,i=arguments;return new Promise((function(n,o){var l=e.apply(t,i);function s(e){m(l,n,o,s,r,"next",e)}function r(e){m(l,n,o,s,r,"throw",e)}s(void 0)}))}}function g(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const f=new class{start(){var e=this;return u((function*(){e.resetState(),e.detectScrollElement(),e.hideScrollbarWithWebkit(),e.domActionsManager.calcAdditionalTotalHeight(),e.domActionsManager.calcAdditionalYOffset(),e.domActionsManager.onStartScrolling(),e.setupClickHandlers(e.endCapture),chrome.storage.local.set({[t.ScreenshotProgress]:1}),e.scrollBar.disable(),yield e.scrollToBottom(5e3),yield i(1e3),e.calculatePageDimensions(),e.calculateArrangements(),e.scrollTo()}))()}resetState(){this.stopCapturing=!1,this.scrollElement=null,this.isFirstElement=!0,this.dimensions=null,this.arrangements=[]}setupClickHandlers(e){[document.body,document.documentElement,window].forEach((t=>{t.addEventListener("click",(()=>e(!0)))})),document.querySelectorAll("*").forEach((t=>{t.addEventListener("click",(()=>e(!0)))}))}calculatePageDimensions(){var e,t,i,n,o,l;const s=document.body,r=document.documentElement,a=[null==r?void 0:r.clientWidth,null==r?void 0:r.scrollWidth,null==r?void 0:r.offsetWidth,null==s?void 0:s.scrollWidth,null==s?void 0:s.offsetWidth,null===(e=this.scrollElement)||void 0===e?void 0:e.scrollWidth,null===(t=this.scrollElement)||void 0===t?void 0:t.offsetWidth].filter(Boolean),d=[null==r?void 0:r.clientHeight,null==r?void 0:r.scrollHeight,null==r?void 0:r.offsetHeight,null==s?void 0:s.scrollHeight,null==s?void 0:s.offsetHeight,null===(i=this.scrollElement)||void 0===i?void 0:i.scrollHeight,null===(n=this.scrollElement)||void 0===n?void 0:n.offsetHeight].filter(Boolean);this.dimensions={maxTotalWidth:Math.max(...a),maxTotalHeight:Math.max(...d),windowWidth:window.innerWidth,windowHeight:Math.max((null===(o=this.scrollElement)||void 0===o?void 0:o.clientHeight)||0,window.innerHeight),scrollWindowHeight:(null===(l=this.scrollElement)||void 0===l?void 0:l.clientHeight)||window.innerHeight}}calculateArrangements(){if(!this.dimensions)return;const e=this.scrollBar.getWidth(),t=this.dimensions.maxTotalHeight>this.dimensions.windowHeight,i=this.dimensions.maxTotalWidth>this.dimensions.windowWidth,n=i?this.dimensions.maxTotalWidth+e:this.dimensions.maxTotalWidth;let o=this.dimensions.maxTotalHeight-this.dimensions.scrollWindowHeight;for(;o>-this.dimensions.windowHeight;){let l=0;for(;l<n;){const s=l>n-this.dimensions.windowWidth?l-(n-this.dimensions.windowWidth):0;this.arrangements.push({x:l-s,y:o>0?o:0,w:this.dimensions.windowWidth,h:this.dimensions.windowHeight}),l+=this.dimensions.windowWidth-(t&&i?e:0)}o-=this.dimensions.scrollWindowHeight-(i?e:0)}}scrollTo(){var n=this;return u((function*(){const o=n.arrangements.shift();if(0===n.arrangements.length?n.domActionsManager.onLastFrame():(n.domActionsManager.onEachFrame(),n.isFirstElement?n.domActionsManager.onFirstFrame():n.domActionsManager.onEachFrameAfterFirst()),!o||!n.dimensions)return void n.endCapture(!1);const l=n.domActionsManager.modifyScreen({x:o.x,y:o.y,width:n.dimensions.windowWidth,height:n.dimensions.windowHeight,totalWidth:n.dimensions.maxTotalWidth,totalHeight:n.dimensions.maxTotalHeight,devicePixelRatio:window.devicePixelRatio});!n.isFirstElement&&n.scrollElement&&n.scrollElement.scrollTo({left:l.x,top:l.y,behavior:"instant"}),0!==n.arrangements.length&&(yield i(100),n.domActionsManager.onNextEachFrame());const s=Math.round((n.dimensions.maxTotalHeight-o.y)/n.dimensions.maxTotalHeight*100);chrome.storage.local.set({[t.ScreenshotProgress]:s}),n.isFirstElement=!1,setTimeout(u((function*(){n.stopCapturing||((yield chrome.storage.local.get(t.ScreenshotCapturing))[t.ScreenshotCapturing]?chrome.runtime.sendMessage({action:e.ContinueCaptureFullPage,screen:l},(()=>n.scrollTo())):n.endCapture(!0))})),400)}))()}detectScrollElement(){const e=document.documentElement,t=document.body;if(e.scrollHeight>e.clientHeight)return void(this.scrollElement=e);if(t.scrollHeight>t.clientHeight)return void(this.scrollElement=t);const i=document.querySelectorAll("*"),n=[];for(const e of i)e.scrollHeight>e.clientHeight&&n.push({diff:e.scrollHeight-e.clientHeight,element:e});var o;n.length>0?this.scrollElement=null===(o=n.sort(((e,t)=>t.diff-e.diff))[0])||void 0===o?void 0:o.element:this.scrollElement=e}hideScrollbarWithWebkit(){if(!this.scrollElement)return;const e=document.createElement("style");e.id="pf-style-hide-scrollbar",e.innerHTML=`\n      ${this.scrollElement.tagName.toLowerCase()}::-webkit-scrollbar {\n        display: none;\n        width: 0;\n      }\n    `,document.head.appendChild(e)}scrollToBottom(e=0){if(!this.scrollElement)return;const t=this.scrollElement.getBoundingClientRect();let i=0;i=this.scrollElement.scrollHeight>e?t.top+window.scrollY+this.scrollElement.scrollHeight:t.top+window.scrollY+this.scrollElement.scrollHeight+100,this.scrollElement.scrollTo({top:i,behavior:"smooth"})}showScrollbarWithWebkit(){const e=document.getElementById("pf-style-hide-scrollbar");e&&e.remove()}constructor(){g(this,"stopCapturing",void 0),g(this,"scrollElement",void 0),g(this,"isFirstElement",void 0),g(this,"dimensions",void 0),g(this,"arrangements",void 0),g(this,"scrollBar",void 0),g(this,"domActionsManager",void 0),g(this,"endCapture",((t=!1)=>{this.stopCapturing?this.domActionsManager.onEndScrolling():(this.scrollBar.enable(),!t&&this.scrollElement&&this.scrollElement.scrollTo(0,0),this.showScrollbarWithWebkit(),this.domActionsManager.onEndScrolling(),t&&(this.stopCapturing=!0),chrome.runtime.sendMessage({action:t?e.CancelCaptureFullPage:e.EndCaptureFullPage}))})),this.stopCapturing=!1,this.scrollElement=null,this.isFirstElement=!0,this.dimensions=null,this.arrangements=[],this.scrollBar=new n,this.domActionsManager=new h}};chrome.runtime.onMessage.addListener((t=>{t.action===e.ScrollPage&&f.start()}))})();