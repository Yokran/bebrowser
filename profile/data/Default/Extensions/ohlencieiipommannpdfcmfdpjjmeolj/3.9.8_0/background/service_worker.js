(()=>{"use strict";function e(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(i,o){var c=t.apply(n,r);function s(t){e(c,i,o,s,a,"next",t)}function a(t){e(c,i,o,s,a,"throw",t)}s(void 0)}))}}const n={"":"root","pf-core":"core",algo:"algo",serviceWorker:"serviceWorker"},r="3.9.8";var i=function(e){return e.OpenPrintFriendly="openPrintfriendly",e.StartCaptureFullPage="startCaptureFullPage",e.CaptureCurrentView="captureCurrentView",e.ContinueCaptureFullPage="continueCaptureFullPage",e.EndCaptureFullPage="endCaptureFullPage",e.CancelCaptureFullPage="cancelCaptureFullPage",e.ScrollPage="scrollPage",e.ConfigureDefaultButton="configureDefaultButton",e}(i||{});chrome.tabs.onUpdated.addListener(((e,t,n)=>{"complete"===t.status&&n.active&&setTimeout((()=>{chrome.tabs.get(e,(e=>{if(e&&e.url){const t=e.url||"",n=e.title||"";if(t)try{const e=new URL(t).hostname;chrome.storage.local.set({printfriendly_website_hostname:e})}catch(e){console.error("Failed to construct URL:",e)}chrome.storage.local.set({printfriendly_website_url:t,printfriendly_website_title:n})}}))}),500)}));const o={};function c(e,t,n=0){const r=e[t.destination];r?r.postMessage(t):n<10?setTimeout((()=>c(e,t,n+1)),100*2**n):console.error(`Could not send message to port ${t.destination}`)}function s(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function c(e){s(o,r,i,c,a,"next",e)}function a(e){s(o,r,i,c,a,"throw",e)}c(void 0)}))}}function l(){return(l=a((function*(){let e=(yield chrome.storage.local.get("printfriendly_client_id")).clientId;return e||(e=self.crypto.randomUUID(),yield chrome.storage.local.set({printfriendly_client_id:e})),e}))).apply(this,arguments)}function u(){return d.apply(this,arguments)}function d(){return d=a((function*(e={}){const t=yield function(){return l.apply(this,arguments)}();console.log(`chrome-extension.${r}.${t}`);try{yield fetch("https://www.google-analytics.com/mp/collect?measurement_id=G-BLWBW4RJE2&api_secret=sN8DehDvT46i0AnXGJUOLg",{method:"POST",body:JSON.stringify({client_id:`chrome-extension.${r}`,events:[e]})})}catch(e){console.warn("Google Analytics request was blocked:",e)}})),d.apply(this,arguments)}let p;function f(){return p="production",p}function h(e,t,n,r,i,o){const c=(e,t)=>{void 0===window.wrappedJSObject?window[e]=t:window.wrappedJSObject[e]=t};c("extensionPath",e),c("extensionTextSize",n),c("extensionImgSize",r),c("extensionIsScreenshotImg",i),c("extensionScreenshotBanner",o);const s="development"===t?"https://v.printfriendly.com":"https://www.printfriendly.com";c("pfOptions",{hosts:{pf:s,email:s},environment:t})}function y(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function c(e){y(o,r,i,c,s,"next",e)}function s(e){y(o,r,i,c,s,"throw",e)}c(void 0)}))}}function g(e,t){return _.apply(this,arguments)}function _(){return _=m((function*(e,t){const{printfriendly_settings_text_size:n,printfriendly_settings_img_size:r,printfriendly_screenshot_images:i,printfriendly_settings_screenshot_banner:o}=yield chrome.storage.local.get(["printfriendly_settings_text_size","printfriendly_settings_img_size","printfriendly_screenshot_images","printfriendly_settings_screenshot_banner"]);yield chrome.scripting.executeScript({target:{tabId:e},func:h,args:[chrome.runtime.getURL("/").replace(/\/$/,""),t,n||"100",r||"100",Boolean(i),void 0===o||o]}),yield chrome.scripting.executeScript({target:{tabId:e},files:["/scripts/printfriendly.js"]})})),_.apply(this,arguments)}function v(){return(v=m((function*(e){const[t]=yield chrome.scripting.executeScript({target:{tabId:e},func:()=>!!window.pfPageScrollInjected});t.result||(yield chrome.scripting.executeScript({target:{tabId:e},files:["/scripts/page-scroll.js"]}),yield chrome.scripting.executeScript({target:{tabId:e},func:()=>{window.pfPageScrollInjected=!0}}))}))).apply(this,arguments)}function w(e){return new Promise((t=>{const n=setTimeout((()=>{clearTimeout(n),t()}),e)}))}function b(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function P(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function c(e){b(o,r,i,c,s,"next",e)}function s(e){b(o,r,i,c,s,"throw",e)}c(void 0)}))}}function x(){return C.apply(this,arguments)}function C(){return(C=P((function*(){const e=yield new Promise((e=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{const n=t[0];e(n)}))})),{format:t}=yield S(),n=yield chrome.tabs.captureVisibleTab(e.windowId,{format:t});yield chrome.storage.local.set({printfriendly_screenshot_images:[n]})}))).apply(this,arguments)}function S(){return O.apply(this,arguments)}function O(){return(O=P((function*(){const e=yield chrome.storage.local.get("printfriendly_settings_screenshot_format");let t="jpeg",n="image/jpeg";return"png"===e.printfriendly_settings_screenshot_format?(t="png",n="image/png"):"jpg"===e.printfriendly_settings_screenshot_format&&(t="jpeg",n="image/jpeg"),{format:t,mimeType:n}}))).apply(this,arguments)}function I(e){const t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);const o=new Blob([r],{type:n});return createImageBitmap(o)}function L(e){return new Promise((t=>{const n=new FileReader;n.readAsDataURL(e),n.onloadend=()=>{t(n.result)}}))}function F(e){return j.apply(this,arguments)}function j(){return(j=P((function*(e,t=""){const n=yield chrome.tabs.get(e);if(n){const e=function(e,t,n=""){let r=function(e){const t=e.match(/^(https?:\/\/)?([^/]+)/);return t?t[2].trim():""}(e).replace("www.","");return r=r.match("printfriendly")?"":r+"-",r=`${r}${t.replace(/[^[a-zA-Z0-9\s_-]/g,"").substring(0,100)}`,n&&(r=`${r}-${n}`),r}(n.url||"",n.title||"",t);yield chrome.storage.local.set({printfriendly_screenshot_filename:e})}chrome.tabs.create({url:"pages/screenshot.html",index:n.index+1})}))).apply(this,arguments)}function R(){return k.apply(this,arguments)}function k(){return(k=P((function*(){yield chrome.storage.local.set({printfriendly_screenshot_images:[]})}))).apply(this,arguments)}function T(e,t){return A.apply(this,arguments)}function A(){return(A=P((function*(e,t){yield chrome.storage.local.set({printfriendly_screenshot_capturing:e,printfriendly_screenshot_progress:0,printfriendly_screenshot_tab_id:t})}))).apply(this,arguments)}function D(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function B(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function c(e){D(o,r,i,c,s,"next",e)}function s(e){D(o,r,i,c,s,"throw",e)}c(void 0)}))}}function E(){return U.apply(this,arguments)}function U(){return(U=B((function*(){const{printfriendly_settings_default_mode:e}=yield chrome.storage.local.get("printfriendly_settings_default_mode");switch(e||"off"){case"off":chrome.action.setPopup({popup:"pages/popup.html"});break;case"printFriendly":case"fullPageScreenshot":case"viewScreenshot":chrome.action.setPopup({popup:""})}}))).apply(this,arguments)}function M(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function z(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function c(e){M(o,r,i,c,s,"next",e)}function s(e){M(o,r,i,c,s,"throw",e)}c(void 0)}))}}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$(e,t,n[t])}))}return e}function N(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const W=32767;class J{captureVisibleArea(e,t){var n=this;return z((function*(){const r=yield chrome.tabs.get(t),{format:i}=yield S();for(let t=0;t<5;t++)try{const t=yield chrome.tabs.captureVisibleTab(r.windowId,{format:i});n.screens.push(N(V({},e),{data:t}));break}catch(e){if(e.message.includes("MAX_CAPTURE_VISIBLE_TAB_CALLS_PER_SECOND")){yield new Promise((e=>setTimeout(e,400)));continue}}}))()}saveFullPageScreenshot(){var e=this;return z((function*(){if(0===e.screens.length)return;yield chrome.storage.local.remove("printfriendly_screenshot_images"),e.screens.reverse();let t=null,n=null,r=0,i=0,o=0;const c=[],s=[];s.push(e.screens[1]),s.push(e.screens[0]),s.push(...e.screens.slice(2));for(let e=0,a=s.length;e<a;++e){const l=s[e];if(!t){const e=l.totalWidth*l.devicePixelRatio;i=r,r=Math.min(W,l.totalHeight*l.devicePixelRatio),t=new OffscreenCanvas(e,r),n=t.getContext("2d")}const u=yield I(l.data),d=l.x*l.devicePixelRatio;let p=0;p=o>0?l.y*l.devicePixelRatio-(i||r)*o:l.y*l.devicePixelRatio,l.yOffset&&(p+=l.yOffset*l.devicePixelRatio),null==n||n.drawImage(u,0,0,u.width,u.height,d,p,u.width,u.height);const f=r-p;if(f>0&&f<l.height*l.devicePixelRatio){const p=yield t.convertToBlob(),h=yield L(p);c.push(h),o++;const y=l.totalWidth*l.devicePixelRatio,m=[W,l.totalHeight*l.devicePixelRatio];if(Math.ceil(m[1]/W)===o+1){let t=0;for(let n=e;n<a;++n){const e=s[n],r=s[n+1];e&&r&&(t+=r.y-e.y)}t*=l.devicePixelRatio,t+=u.height-f,m.push(t)}i=r,r=Math.min(...m),t=new OffscreenCanvas(y,r),n=t.getContext("2d"),null==n||n.drawImage(u,0,f,u.width,u.height,d,0,u.width,u.height)}}if(t){const e=yield t.convertToBlob(),n=yield L(e);c.push(n)}yield chrome.storage.local.set({printfriendly_screenshot_images:c}),e.screens=[]}))()}cancelFullPageScreenshot(){var e=this;return z((function*(){0!==e.screens.length&&(e.screens=[],yield chrome.storage.local.set({printfriendly_screenshot_images:""}))}))()}constructor(){$(this,"screens",[])}}function G(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function q(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function c(e){G(o,r,i,c,s,"next",e)}function s(e){G(o,r,i,c,s,"throw",e)}c(void 0)}))}}function H(){return X.apply(this,arguments)}function X(){return(X=q((function*(){const e=yield chrome.storage.local.get("printfriendly_popup_window_id");try{e.printfriendly_popup_window_id&&(yield chrome.storage.local.remove("printfriendly_popup_window_id"),yield chrome.windows.remove(e.printfriendly_popup_window_id))}catch(e){}}))).apply(this,arguments)}function Z(){return(Z=q((function*(e){const t=yield chrome.tabs.get(e),n=t.width||800,r=t.windowId;if(r){const e=yield chrome.windows.get(r),i=yield chrome.windows.create({url:"pages/popup.html",type:"popup",width:300,height:280,left:n-300,top:(e.height||0)-(t.height||0)+(e.top||0)});yield chrome.storage.local.set({printfriendly_popup_window_id:i.id})}}))).apply(this,arguments)}function K(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function c(e){K(o,r,i,c,s,"next",e)}function s(e){K(o,r,i,c,s,"throw",e)}c(void 0)}))}}const Y=function(){const e=new EventTarget;return{emit(t){const n=new CustomEvent(t.type,{detail:t.data});e.dispatchEvent(n)},on(t,n){e.addEventListener(t,(e=>{n(e.detail)}))},off(t,n){e.removeEventListener(t,n)}}}();chrome.runtime.onInstalled.addListener((()=>{fetch("https://api.printfriendly.com/v2/defaults").then((e=>e.json())).then((e=>{chrome.storage.local.set({printfriendly_settings_paper_size:e.page_size})})).catch((()=>chrome.storage.local.set({printfriendly_settings_paper_size:"Letter"}))),chrome.storage.local.set({printfriendly_screenshot_images:""}),chrome.storage.local.remove("printfriendly_popup_window_id"),chrome.storage.local.remove("printfriendly_screenshot_img"),chrome.storage.local.remove("printfriendly_screenshot_slices")})),chrome.runtime.onInstalled.addListener(t((function*(){try{(yield chrome.storage.local.get()).alreadyShownIntro||(chrome.tabs.create({url:chrome.runtime.getURL("pages/intro.html")}),yield chrome.storage.local.set({alreadyShownIntro:!0}))}catch(e){console.error("Could not open intro")}})));const ee=function(e){const t=f();return chrome.action.onClicked.addListener(function(){var n=B((function*(n){const{printfriendly_settings_default_mode:r}=yield chrome.storage.local.get("printfriendly_settings_default_mode");switch(u({name:"extension_navbar_start",params:{}}),r||"off"){case"off":case"printFriendly":yield R(),(null==n?void 0:n.id)?yield g(n.id,t):console.warn("printfriendly. No tab found (browser action)");break;case"viewScreenshot":yield x(),(null==n?void 0:n.id)?yield F(n.id,"cvscreenshot"):console.warn("viewScreenshot. No tab found (browser action)");break;case"fullPageScreenshot":e.emit({type:i.StartCaptureFullPage,data:{tabId:null==n?void 0:n.id}})}}));return function(e){return n.apply(this,arguments)}}()),E(),{messageListener:(e,n,r)=>B((function*(){if(e.action===i.OpenPrintFriendly){u({name:"extension_navbar_start",params:{}}),r({success:!0});const n=e.tabId;n?(R(),yield g(n,t)):console.warn("No tab found (openPrintFriendly)")}else e.action===i.ConfigureDefaultButton&&(yield E(),r({success:!0}))}))()}}(Y),te=function(e){const t=new J,n=function(){var e=Q((function*(e){(yield chrome.storage.local.get("printfriendly_popup_window_id")).printfriendly_popup_window_id!==e.windowId&&(yield c())}));return function(t){return e.apply(this,arguments)}}(),r=function(){var e=Q((function*(e,t){e&&(t&&(yield w(t),yield function(e){return Z.apply(this,arguments)}(e)),chrome.tabs.onActivated.addListener(n),yield T(!0,e),chrome.action.setPopup({popup:"pages/popup.html"}),yield function(e){return v.apply(this,arguments)}(e),chrome.tabs.sendMessage(e,{action:i.ScrollPage}))}));return function(t,n){return e.apply(this,arguments)}}(),o=function(){var e=Q((function*(){yield t.saveFullPageScreenshot(),E();const{printfriendly_screenshot_tab_id:e}=yield chrome.storage.local.get(["printfriendly_screenshot_tab_id"]);return yield H(),e&&(yield F(e,"fpscreenshot")),chrome.tabs.onActivated.removeListener(n),yield T(!1,0),{success:!0}}));return function(){return e.apply(this,arguments)}}(),c=function(){var e=Q((function*(){return yield T(!1,0),yield t.cancelFullPageScreenshot(),yield H(),E(),{success:!0}}));return function(){return e.apply(this,arguments)}}(),s=function(){var e=Q((function*(e,t){return t&&(yield w(t)),yield R(),yield T(!1,0),yield x(),yield F(e,"cvscreenshot"),{success:!0}}));return function(t,n){return e.apply(this,arguments)}}(),a=function(){var e=Q((function*(e){const{printfriendly_screenshot_tab_id:n}=yield chrome.storage.local.get(["printfriendly_screenshot_tab_id"]);return n&&(yield t.captureVisibleArea(e,n)),{success:!0}}));return function(t){return e.apply(this,arguments)}}();return chrome.runtime.onConnect.addListener((e=>{e.onDisconnect.addListener(Q((function*(){const{printfriendly_screenshot_capturing:e}=yield chrome.storage.local.get("printfriendly_screenshot_capturing");e&&(yield c())})))})),e.on(i.StartCaptureFullPage,(e=>{r(e.tabId,10)})),{messageListener:(e,t,n)=>Q((function*(){switch(e.action){case i.CaptureCurrentView:s(e.tabId,e.delay).then(n);break;case i.StartCaptureFullPage:r(e.tabId,e.delay).then((()=>n({success:!0})));break;case i.ContinueCaptureFullPage:a(e.screen).then((()=>n({success:!0})));break;case i.EndCaptureFullPage:o().then(n);break;case i.CancelCaptureFullPage:c().then(n)}}))()}}(Y);var ne;!function(){const e=f();chrome.contextMenus.onClicked.addListener(((t,n)=>{"printfriendly"===t.menuItemId&&u({name:"context_menu_start",params:{}}),(null==n?void 0:n.id)?g(n.id,e):console.warn("No tab found (context menu)")})),chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"printfriendly",title:"Print Friendly and PDF",contexts:["page","selection","link","editable","image","frame"]})}))}(),chrome.runtime.setUninstallURL("https://printfriendly.com/extension_feedback/new"),ne=[ee.messageListener,te.messageListener],chrome.runtime.onMessage.addListener(((e,t,n)=>{var r;const i=(null===(r=t.tab)||void 0===r?void 0:r.id)||0,s=o[i];if(e.action)for(const r of ne)r(e,t,n);else if(s)return c(s,e),n({success:!0}),!1;return!0})),chrome.runtime.onConnect.addListener((function(e){var t,r;const i=(null===(r=e.sender)||void 0===r||null===(t=r.tab)||void 0===t?void 0:t.id)||0;o[i]||(o[i]={root:null,core:null,algo:null});const c=o[i],s=n[e.name];c[s]=e,e.onDisconnect.addListener((()=>{delete c[s]})),e.onMessage.addListener((function(e){c[e.destination].postMessage(e)}))}))})();