import{m as I,k as D,T as x,M as fe,w as he,c as Oe}from"./_commonjsHelpers-DBcs7C3A.js";import{b as _e,A as Pe,I as Ee,h as je,g as Ae,C as Re,y as Be,m as Ue,u as Ne,p as me,d as ge,P as ye}from"./index-4Xml3FNN.js";import{p as N,h as q,e as qe}from"./const-DWvXfhm_.js";function He(n){const{hostMatch:e,extensionId:t,extensionName:r}=n;chrome.tabs.onUpdated.addListener(async(c,u,s)=>{if(s&&s.url&&s&&s.url&&u&&u.status==="loading"){const m=new URL(s.url).hostname;if(e.find(d=>!!~d.indexOf(m))){const d=chrome.runtime.getManifest();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:c,allFrames:!0},func:b=>{window[b.slug]=b},args:[{id:chrome.runtime.id,slug:t,extensionName:r,version:d.version,icons:d.icons,extensionFolderUri:chrome.runtime.getURL("/"),isProdMode:"update_url"in chrome.runtime.getManifest()}]})}}})}var Te=(n=>(n[n.FREE=0]="FREE",n[n.BASIC=1]="BASIC",n[n.PREMIUM=2]="PREMIUM",n))(Te||{});const Ve={type:"object",properties:{uid:{type:"string",default:""},email:{type:"string",default:""},stripeId:{type:"string",default:""},name:{type:"string",default:""},payments:{type:"array",items:{type:"object",properties:{},required:[],default:{}},default:[]},plan:{type:"string",default:Te.FREE},isSubscriptionActive:{type:"boolean",default:!1},lastCheckAt:{type:"number",default:0}},required:["uid","email","stripeId","name","payments","plan","isSubscriptionActive","lastCheckAt"],default:{}},Ye={type:"object",properties:{},required:[],default:{}},We={type:"object",properties:{},required:[],default:{}},ee={customerDataV2:Ve,features:Ye,persistLocalStorage:We};function pe(n,e){Object.keys(n).map(t=>e(n[t],t,n))}function X(n,e){function t(u,s){switch(u.type){case"object":return r(u,s);case"array":return c(u,s);default:return s!==void 0?s:u.default!==void 0?u.default:void 0}}function r(u,s){const m={},d=u.properties??{};return pe(d,(b,T)=>{if(u.required.includes(T)||s!==void 0&&s[T]!==void 0){let f=s!==void 0?s[T]:void 0;!b.properties&&b.default&&b.type==="object"&&b.additionalProperties&&(f=b.default),m[T]=t(b,f)}}),s&&pe(s,(b,T)=>{m[T]===void 0&&b!==void 0&&(m[T]=b)}),m}function c(u,s){if(s===void 0)return u.default?u.default:void 0;const m=[];for(let d=0;d<s.length;d++)m.push(t(u.items??{},s[d]));return m}return t(e,n)}const re="__storage-local-version";function Je(n){const e=Object.keys(n);chrome.runtime.onInstalled.addListener(r=>{(r.reason==="install"||r.reason==="update")&&t()});async function t(){let r=(await chrome.storage.local.get(re))[re];const c=chrome.runtime.getManifest().version;if(c!==r){const u=await chrome.storage.local.get(e),s=e.reduce((m,d)=>{let b=u[d]||{};return b=X(b,n[d]),m[d]=b,m},{[re]:c});await chrome.storage.local.set(s)}}}function ce(n,e){async function t(s){let m;return await navigator.locks.request(G(s),{mode:"shared"},async()=>{m=(await be(s))[s]}),m===void 0&&(m=X(m,n[s])),m}async function r(s,m){await navigator.locks.request(G(s),{mode:"exclusive"},async()=>{let d=(await be(s))[s];d===void 0&&(d=X(d,n[s]));const b=await m(d);await chrome.storage.local.set({[s]:b})})}async function c(s,m){await navigator.locks.request(G(s),{mode:"exclusive"},async()=>{let d=m||{};m||(d=X(d,n[s])),await chrome.storage.local.set({[s]:d})})}async function u(s){return await navigator.locks.request(G(s),{mode:"exclusive"},async()=>{await chrome.storage.local.remove([s])}),Promise.resolve()}return{updateBucket:r,setBucket:c,getBucket:t,deleteBucket:u}}function G(n){return`storage.local.${n}`}function be(n){return new Promise(e=>{chrome.storage.local.get(n,t=>{e(t)})})}function ke(){return Math.floor(new Date().getTime()/1e3)}function ve(n){return n+86400<ke()}async function Ke(n){const e=await chrome.tabs.query({url:n.filter(t=>!~t.indexOf("esuit"))});for(let t of e)t.id&&await chrome.tabs.reload(t.id)}let z=[];const{updateBucket:we,getBucket:se,deleteBucket:$e}=ce(ee);function Ge(n){I("logout",async()=>{await $e("customerDataV2"),await $e("features")}),I("login",async()=>{const e=new URLSearchParams({[fe.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:`https://esuit.dev/login?${e}`,active:!0})}),I("closePopup",async()=>{chrome.extension.getViews({type:"popup"}).forEach(e=>{e.window.close()})}),I("openOptionsPage",async e=>{const t=chrome.runtime.getURL("src/pages/options/index.html"+(e?"#showSubscription=1":""));(await chrome.tabs.query({url:[t]})).forEach(r=>(r==null?void 0:r.id)&&chrome.tabs.remove(r.id)),await new Promise(r=>setTimeout(r,300)),await chrome.tabs.create({url:t,active:!0})}),I("getCustomerData",async()=>{const e=await se("customerDataV2");if(e.uid)return ve(e.lastCheckAt)&&D("reFetchCustomerData"),e}),I("reFetchCustomerData",async(e=!1)=>{const t=await se("customerDataV2"),r=t.uid;if(!r)return!1;if(!e&&r&&!ve(t.lastCheckAt))return!0;let c=null,u=null;try{const[d,b]=await Promise.all([fetch(`https://getusersubscription-57pphaecyq-uc.a.run.app/?token=${_e(r,n.projectId)}`).then(T=>T.json()),ze()]);if(d.stripeId&&(c=d),b){const T=b.find(f=>f.projectId===n.projectId);T&&(u=T)}}catch(d){return console.error(d),"Unknown error, please contact the developer."}if(!c||!u)return"ERROR: reFetchCustomerData returned undefined";let s=c.allPayments.filter(d=>Pe(d.status)||Ee(d.status)||je(d.status)||Ae(d.status)||Re(d.status)),m=x.FREE;return Me(s,u,x.BASIC)&&(m=x.BASIC),Me(s,u,x.PREMIUM)&&(m=x.PREMIUM),await we("customerDataV2",async d=>c?{uid:r,stripeId:c.stripeId,email:c.email,name:c.name,payments:c.allPayments,plan:m,isSubscriptionActive:m!==x.FREE,lastCheckAt:ke()}:d),D("rejectFeaturesToWindow"),!0}),I("visitPricingPage",async()=>{const e=`https://esuit.dev/pricing/${n.projectId}`,t=new URLSearchParams({[fe.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:e+`?${t}`,active:!0})}),I("visitDashboard",async()=>{await chrome.tabs.create({url:"https://esuit.dev/dashboard",active:!0}),D("closePopup")}),he("ifUserLogin",async()=>!!(await se("customerDataV2")).uid),he("userInfoUpdate",async([e])=>{e&&(await we("customerDataV2",t=>(t.uid=e,t)),await D("reFetchCustomerData",!0),D("openOptionsPage",!0),setTimeout(()=>{Ke(n.hostMatch)},2e3))})}async function ze(){if(z.length>0)return z;const n=await fetch("https://static-data.esuit.dev/index.json").then(e=>e.json());return z=Be(n),z}function Me(n,e,t){return!!n.find(r=>{if(![...Ue,...Ne,...me,...ge,...ye].includes(r.status)||[...me].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...ge].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...ye].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3)))return!1;const c=e.prices.find(u=>u.id===r.priceId);return!(!c||c.plan!==t)})}var Ze=Object.defineProperty,Qe=(n,e,t)=>e in n?Ze(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Z=(n,e,t)=>(Qe(n,typeof e!="symbol"?e+"":e,t),t);class ue{constructor(e,t){Z(this,"listeners",{}),Z(this,"tabs",[]),Z(this,"slug"),Z(this,"isDebugger"),this.slug=e,this.isDebugger=!!t,this.bindMessage(),this.bindEvent()}on(e,t){if(this.listeners[e])throw new Error(`event listener ${String(e)} already exist!`);return this.listeners[e]=t,()=>{delete this.listeners[e]}}async send(e,...t){this.isDebugger&&console.log("send message from background script",{action:e,payload:t,tabs:this.tabs});for(let r of this.tabs)try{const c=await chrome.tabs.get(r);c&&c.id?chrome.tabs.sendMessage(c.id,{from:this.slug,payload:{action:e,payload:t}}):this.deleteTabById(r)}catch(c){console.log(c),this.deleteTabById(r)}}bindMessage(){chrome.runtime.onMessageExternal.addListener((e,t,r)=>{var c,u;if((c=t==null?void 0:t.tab)!=null&&c.id){if(this.isDebugger&&console.log("received message from page",{request:e,sender:t}),e.action==="__connect")return this.tabs.includes(t.tab.id)||this.tabs.push(t.tab.id),r();if(e.action==="__disconnect")return this.deleteTabById(t.tab.id),r();if(this.listeners[e.action])return(u=t==null?void 0:t.tab)!=null&&u.id?(this.tabs.includes(t.tab.id)||this.tabs.push(t.tab.id),this.listeners[e.action](...e.payload).then(s=>{this.isDebugger&&console.log("send to callback from background",{request:e,sender:t,res:s}),r(s)}),!0):r();console.log(`unknown event ${e.action}`)}})}bindEvent(){chrome.tabs.onRemoved.addListener(e=>{this.deleteTabById(e)})}deleteTabById(e){if(this.tabs.includes(e)){const t=this.tabs.indexOf(e);this.tabs.splice(t,1)}}}function Xe(n){return[x.FREE,x.BASIC,x.PREMIUM].indexOf(n)}function et(n,e){const t=Xe(e);return n.limitation?n.limitation[t]:0}function De(n,e){return{[x.FREE]:1,[x.BASIC]:10,[x.PREMIUM]:100}[e]>=n.permission}function ae(n,e){return n.map(t=>{e[t.key]?(e[t.key].enable=e[t.key].enable??t.defaultEnable,e[t.key].currentFreeTryCount=e[t.key].currentFreeTryCount??0):e[t.key]={enable:t.defaultEnable,currentFreeTryCount:0}}),e}function tt(n){const{cacheId:e,defaultMemoConfig:t}=n;I("setUIMemoSettings",async r=>{await chrome.storage.local.set({[e]:r})}),I("getUIMemoSettings",async()=>{const r=await D("getFeaturesDataByPlan");let c=await new Promise(u=>{chrome.storage.local.get([e]).then(s=>{s[e]?u(s[e]):u(!1)})});return c||(c={...t}),Object.keys(c).map(u=>{const s=Object.values(r).find(d=>d._.memoKey===u);if(s&&s.needUpgrade&&(!s.enable||!(s.freeTryLeft>0||s.limitation>0)&&t[u]!==void 0))return m();function m(){c[u]=t[u]}}),{...t,...c}})}let Ce=!1;function nt(){return Ce}function rt(){Ce=!0}const{updateBucket:ie,getBucket:Se}=ce(ee);function st(n){if(nt())return;rt();const e=new ue(n,!0);return I("getAllPersistLocalStorage",()=>Se("persistLocalStorage")),I("setPersistLocalStorage",async(t,r)=>{await ie("persistLocalStorage",c=>{try{r=JSON.stringify(r)}catch{}return c[t]=r,c})}),I("getPersistLocalStorage",async(t,r)=>{const c=await Se("persistLocalStorage");if(c[t]){try{return JSON.parse(c[t])}catch{}return c[t]}return r??void 0}),I("clearPersistLocalStorage",async()=>{ie("persistLocalStorage",()=>({}))}),I("removePersistLocalStorage",async t=>{ie("persistLocalStorage",r=>(delete r[t],r))}),e.on("getAllPersistLocalStorage",()=>D("getAllPersistLocalStorage")),e.on("setPersistLocalStorage",(...t)=>D("setPersistLocalStorage",...t)),e.on("getPersistLocalStorage",(...t)=>D("getPersistLocalStorage",...t)),e.on("clearPersistLocalStorage",()=>D("clearPersistLocalStorage")),void e.on("removePersistLocalStorage",t=>D("removePersistLocalStorage",t))}const{setBucket:Ie,getBucket:oe}=ce(ee);function at(n){const{projectId:e,hostMatch:t,cacheId:r,features:c,defaultMemoConfig:u}=n,s=new ue(e,!0);return st(n.projectId),tt({cacheId:r,defaultMemoConfig:u}),chrome.tabs.onUpdated.addListener(async(f,M,g)=>{if(g&&g.url&&M.status==="loading"){const $=new URL(g.url).hostname;t.find(P=>!!~P.indexOf($))&&d(f)}}),chrome.storage.onChanged.addListener((f,M)=>{M==="local"&&f&&f.features&&m()}),I("rejectFeaturesToWindow",async()=>{m()}),I("getFeature",async f=>b()[f]),I("consumeFeaturesTreeTryByMemoUIConfigs",async f=>{const M=await b();let g=[];Object.entries(f).map(([$,P])=>{if(u[$]!==void 0&&u[$]!==P){const O=Object.values(M).find(E=>E._.memoKey===$);O&&O.isCanFreeTry&&g.push(O._.key)}}),g.length>0&&D("consumeFeatureTreeTry",g)}),I("consumeFeatureTreeTry",async f=>{let M=ae(c,await oe("features"));const g=await T();let $=!1;f.map(P=>{const O=c.find(E=>E.key===P||E.memoKey===P);O&&(De(O,g)||(M[O.key].currentFreeTryCount++,$=!0))}),$&&await Ie("features",M)}),I("saveFeaturesEnables",async f=>{let M=ae(c,await oe("features"));Object.entries(f).map(([g,$])=>{M[g].enable=$}),await Ie("features",M)}),I("getFeaturesDataByPlan",b),s.on("getUIMemoSettings",()=>D("getUIMemoSettings")),s.on("setUIMemoSettings",f=>D("setUIMemoSettings",f)),s.on("consumeFeatureTreeTry",f=>D("consumeFeatureTreeTry",f)),s.on("visitPricingPage",()=>D("visitPricingPage")),void s.on("consumeFeaturesTreeTryByMemoUIConfigs",f=>{D("consumeFeaturesTreeTryByMemoUIConfigs",f)});async function m(){const f=await chrome.tabs.query({url:t});f&&f.map(M=>{M&&M.id&&d(M.id)})}async function d(f){const M=await b();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:f,allFrames:!0},func:(g,$)=>{window[$]=JSON.parse(g)},args:[JSON.stringify(M),`${e.replaceAll("-","_")}`]})}async function b(){const f=await T();let M=ae(c,await oe("features"));return c.map(g=>{var $;const P=De(g,f);let O,E=0;return g.memoKey&&(O=u[g.memoKey]),g.maxFreeTryCount&&M[g.key].currentFreeTryCount!==void 0&&(E=Math.max(0,g.maxFreeTryCount-M[g.key].currentFreeTryCount)),{enable:(($=M[g.key])==null?void 0:$.enable)??g.defaultEnable,needUpgrade:!P,limitation:et(g,f),permission:g.permission,freeTryLeft:g.maxFreeTryCount?E:0,isCanFreeTry:!!g.maxFreeTryCount&&g.maxFreeTryCount>0,defaultValue:O,_:g}}).reduce((g,$)=>(g[$._.key]=$,g),{})}async function T(){const f=await D("getCustomerData");return f?f.plan:x.FREE}}function it(n,e){(async()=>{let t=0,r=(await chrome.declarativeNetRequest.getDynamicRules()).map(u=>u.id);const c=n.map((u,s)=>(t=s+1,{id:t,priority:1,action:{type:"modifyHeaders",responseHeaders:[{header:"Content-Security-Policy",operation:"remove"},{header:"Content-Security-Policy-Report-Only",operation:"remove"}]},condition:{regexFilter:u,resourceTypes:["main_frame","xmlhttprequest"]}}));await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:r,addRules:c})})()}function ot(n){const e=new ue(n,!0);e.on("reFetchCustomerData",t=>D("reFetchCustomerData",t)),e.on("visitDashboard",()=>D("visitDashboard")),e.on("getCustomerData",()=>D("getCustomerData")),e.on("logout",()=>D("logout")),e.on("login",()=>D("login"))}function ct(n){Je(ee),Ge(n),ot(n.projectId)}var ut={exports:{}};(function(n,e){(function(t,r){n.exports=r()})(Oe,function(){var t=1e3,r=6e4,c=36e5,u="millisecond",s="second",m="minute",d="hour",b="day",T="week",f="month",M="quarter",g="year",$="date",P="Invalid Date",O=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,E=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Le={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(h){var o=["th","st","nd","rd"],a=h%100;return"["+h+(o[(a-20)%10]||o[a]||o[0])+"]"}},te=function(h,o,a){var l=String(h);return!l||l.length>=o?h:""+Array(o+1-l.length).join(a)+h},xe={s:te,z:function(h){var o=-h.utcOffset(),a=Math.abs(o),l=Math.floor(a/60),i=a%60;return(o<=0?"+":"-")+te(l,2,"0")+":"+te(i,2,"0")},m:function h(o,a){if(o.date()<a.date())return-h(a,o);var l=12*(a.year()-o.year())+(a.month()-o.month()),i=o.clone().add(l,f),y=a-i<0,p=o.clone().add(l+(y?-1:1),f);return+(-(l+(a-i)/(y?i-p:p-i))||0)},a:function(h){return h<0?Math.ceil(h)||0:Math.floor(h)},p:function(h){return{M:f,y:g,w:T,d:b,D:$,h:d,m,s,ms:u,Q:M}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(h){return h===void 0}},H="en",A={};A[H]=Le;var le="$isDayjsObject",ne=function(h){return h instanceof J||!(!h||!h[le])},W=function h(o,a,l){var i;if(!o)return H;if(typeof o=="string"){var y=o.toLowerCase();A[y]&&(i=y),a&&(A[y]=a,i=y);var p=o.split("-");if(!i&&p.length>1)return h(p[0])}else{var w=o.name;A[w]=o,i=w}return!l&&i&&(H=i),i||!l&&H},k=function(h,o){if(ne(h))return h.clone();var a=typeof o=="object"?o:{};return a.date=h,a.args=arguments,new J(a)},v=xe;v.l=W,v.i=ne,v.w=function(h,o){return k(h,{locale:o.$L,utc:o.$u,x:o.$x,$offset:o.$offset})};var J=function(){function h(a){this.$L=W(a.locale,null,!0),this.parse(a),this.$x=this.$x||a.x||{},this[le]=!0}var o=h.prototype;return o.parse=function(a){this.$d=function(l){var i=l.date,y=l.utc;if(i===null)return new Date(NaN);if(v.u(i))return new Date;if(i instanceof Date)return new Date(i);if(typeof i=="string"&&!/Z$/i.test(i)){var p=i.match(O);if(p){var w=p[2]-1||0,S=(p[7]||"0").substring(0,3);return y?new Date(Date.UTC(p[1],w,p[3]||1,p[4]||0,p[5]||0,p[6]||0,S)):new Date(p[1],w,p[3]||1,p[4]||0,p[5]||0,p[6]||0,S)}}return new Date(i)}(a),this.init()},o.init=function(){var a=this.$d;this.$y=a.getFullYear(),this.$M=a.getMonth(),this.$D=a.getDate(),this.$W=a.getDay(),this.$H=a.getHours(),this.$m=a.getMinutes(),this.$s=a.getSeconds(),this.$ms=a.getMilliseconds()},o.$utils=function(){return v},o.isValid=function(){return this.$d.toString()!==P},o.isSame=function(a,l){var i=k(a);return this.startOf(l)<=i&&i<=this.endOf(l)},o.isAfter=function(a,l){return k(a)<this.startOf(l)},o.isBefore=function(a,l){return this.endOf(l)<k(a)},o.$g=function(a,l,i){return v.u(a)?this[l]:this.set(i,a)},o.unix=function(){return Math.floor(this.valueOf()/1e3)},o.valueOf=function(){return this.$d.getTime()},o.startOf=function(a,l){var i=this,y=!!v.u(l)||l,p=v.p(a),w=function(B,L){var j=v.w(i.$u?Date.UTC(i.$y,L,B):new Date(i.$y,L,B),i);return y?j:j.endOf(b)},S=function(B,L){return v.w(i.toDate()[B].apply(i.toDate("s"),(y?[0,0,0,0]:[23,59,59,999]).slice(L)),i)},C=this.$W,F=this.$M,_=this.$D,U="set"+(this.$u?"UTC":"");switch(p){case g:return y?w(1,0):w(31,11);case f:return y?w(1,F):w(0,F+1);case T:var R=this.$locale().weekStart||0,V=(C<R?C+7:C)-R;return w(y?_-V:_+(6-V),F);case b:case $:return S(U+"Hours",0);case d:return S(U+"Minutes",1);case m:return S(U+"Seconds",2);case s:return S(U+"Milliseconds",3);default:return this.clone()}},o.endOf=function(a){return this.startOf(a,!1)},o.$set=function(a,l){var i,y=v.p(a),p="set"+(this.$u?"UTC":""),w=(i={},i[b]=p+"Date",i[$]=p+"Date",i[f]=p+"Month",i[g]=p+"FullYear",i[d]=p+"Hours",i[m]=p+"Minutes",i[s]=p+"Seconds",i[u]=p+"Milliseconds",i)[y],S=y===b?this.$D+(l-this.$W):l;if(y===f||y===g){var C=this.clone().set($,1);C.$d[w](S),C.init(),this.$d=C.set($,Math.min(this.$D,C.daysInMonth())).$d}else w&&this.$d[w](S);return this.init(),this},o.set=function(a,l){return this.clone().$set(a,l)},o.get=function(a){return this[v.p(a)]()},o.add=function(a,l){var i,y=this;a=Number(a);var p=v.p(l),w=function(F){var _=k(y);return v.w(_.date(_.date()+Math.round(F*a)),y)};if(p===f)return this.set(f,this.$M+a);if(p===g)return this.set(g,this.$y+a);if(p===b)return w(1);if(p===T)return w(7);var S=(i={},i[m]=r,i[d]=c,i[s]=t,i)[p]||1,C=this.$d.getTime()+a*S;return v.w(C,this)},o.subtract=function(a,l){return this.add(-1*a,l)},o.format=function(a){var l=this,i=this.$locale();if(!this.isValid())return i.invalidDate||P;var y=a||"YYYY-MM-DDTHH:mm:ssZ",p=v.z(this),w=this.$H,S=this.$m,C=this.$M,F=i.weekdays,_=i.months,U=i.meridiem,R=function(L,j,Y,K){return L&&(L[j]||L(l,y))||Y[j].slice(0,K)},V=function(L){return v.s(w%12||12,L,"0")},B=U||function(L,j,Y){var K=L<12?"AM":"PM";return Y?K.toLowerCase():K};return y.replace(E,function(L,j){return j||function(Y){switch(Y){case"YY":return String(l.$y).slice(-2);case"YYYY":return v.s(l.$y,4,"0");case"M":return C+1;case"MM":return v.s(C+1,2,"0");case"MMM":return R(i.monthsShort,C,_,3);case"MMMM":return R(_,C);case"D":return l.$D;case"DD":return v.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return R(i.weekdaysMin,l.$W,F,2);case"ddd":return R(i.weekdaysShort,l.$W,F,3);case"dddd":return F[l.$W];case"H":return String(w);case"HH":return v.s(w,2,"0");case"h":return V(1);case"hh":return V(2);case"a":return B(w,S,!0);case"A":return B(w,S,!1);case"m":return String(S);case"mm":return v.s(S,2,"0");case"s":return String(l.$s);case"ss":return v.s(l.$s,2,"0");case"SSS":return v.s(l.$ms,3,"0");case"Z":return p}return null}(L)||p.replace(":","")})},o.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},o.diff=function(a,l,i){var y,p=this,w=v.p(l),S=k(a),C=(S.utcOffset()-this.utcOffset())*r,F=this-S,_=function(){return v.m(p,S)};switch(w){case g:y=_()/12;break;case f:y=_();break;case M:y=_()/3;break;case T:y=(F-C)/6048e5;break;case b:y=(F-C)/864e5;break;case d:y=F/c;break;case m:y=F/r;break;case s:y=F/t;break;default:y=F}return i?y:v.a(y)},o.daysInMonth=function(){return this.endOf(f).$D},o.$locale=function(){return A[this.$L]},o.locale=function(a,l){if(!a)return this.$L;var i=this.clone(),y=W(a,l,!0);return y&&(i.$L=y),i},o.clone=function(){return v.w(this.$d,this)},o.toDate=function(){return new Date(this.valueOf())},o.toJSON=function(){return this.isValid()?this.toISOString():null},o.toISOString=function(){return this.$d.toISOString()},o.toString=function(){return this.$d.toUTCString()},h}(),de=J.prototype;return k.prototype=de,[["$ms",u],["$s",s],["$m",m],["$H",d],["$W",b],["$M",f],["$y",g],["$D",$]].forEach(function(h){de[h[1]]=function(o){return this.$g(o,h[0],h[1])}}),k.extend=function(h,o){return h.$i||(h(o,J,k),h.$i=!0),k},k.locale=W,k.isDayjs=ne,k.unix=function(h){return k(1e3*h)},k.en=A[H],k.Ls=A,k.p={},k})})(ut);const lt=["-**caption**-","-**date**-","-**timestamp**-","-**username**-_-**date**-","-**username**-_-**timestamp**-"];var Fe=(n=>(n.HD="hd",n.SD="sd",n.HIGHEST_QUALITY_VIDEO_AND_AUDIO="highest",n))(Fe||{});const dt=[{key:"GEN_FOLDER",name:"Gen-Folder",permission:1,defaultEnable:!0,memoKey:null},{key:"FILENAME_FORMATS",name:"Filename formats",maxFreeTryCount:100,permission:10,defaultEnable:!0,memoKey:"fileNameFormatRule"},{key:"DEFAULT_DOWNLOAD",name:"Default download set",maxFreeTryCount:100,permission:10,defaultEnable:!0,memoKey:"defaultDownloadSet"}],ft={isGenFolder:!1,fileNameFormatRule:lt[0],defaultDownloadSet:Fe.HD};var ht=Object.defineProperty,mt=(n,e,t)=>e in n?ht(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Q=(n,e,t)=>(mt(n,typeof e!="symbol"?e+"":e,t),t);class gt{constructor(e,t){Q(this,"listeners",{}),Q(this,"tabs",[]),Q(this,"slug"),Q(this,"isDebugger"),this.slug=e,this.isDebugger=!!t,this.bindMessage(),this.bindEvent()}on(e,t){if(this.listeners[e])throw new Error(`event listener ${String(e)} already exist!`);return this.listeners[e]=t,()=>{delete this.listeners[e]}}async send(e,...t){this.isDebugger&&console.log("send message from background script",{action:e,payload:t,tabs:this.tabs});for(let r of this.tabs)try{const c=await chrome.tabs.get(r);c&&c.id?chrome.tabs.sendMessage(c.id,{from:this.slug,payload:{action:e,payload:t}}):this.deleteTabById(r)}catch(c){console.log(c),this.deleteTabById(r)}}bindMessage(){chrome.runtime.onMessageExternal.addListener((e,t,r)=>{var c,u;if((c=t==null?void 0:t.tab)!=null&&c.id){if(this.isDebugger&&console.log("received message from page",{request:e,sender:t}),e.action==="__connect")return this.tabs.includes(t.tab.id)||this.tabs.push(t.tab.id),r();if(e.action==="__disconnect")return this.deleteTabById(t.tab.id),r();if(this.listeners[e.action])return(u=t==null?void 0:t.tab)!=null&&u.id?(this.tabs.includes(t.tab.id)||this.tabs.push(t.tab.id),this.listeners[e.action](...e.payload).then(s=>{this.isDebugger&&console.log("send to callback from background",{request:e,sender:t,res:s}),r(s)}),!0):r();console.log(`unknown event ${e.action}`)}})}bindEvent(){chrome.tabs.onRemoved.addListener(e=>{this.deleteTabById(e)})}deleteTabById(e){if(this.tabs.includes(e)){const t=this.tabs.indexOf(e);this.tabs.splice(t,1)}}}function yt(){const n=new gt(N,!1);n.on("downloadVideo",async(e,t)=>{await chrome.downloads.download({url:e,filename:t,conflictAction:"overwrite"})}),n.on("visitPricing",async()=>{D("visitPricingPage")})}it(q);yt();He({hostMatch:q,extensionId:N,extensionName:qe});ct({projectId:N,callbackExtId:chrome.runtime.id,hostMatch:q});at({projectId:N,hostMatch:q,cacheId:"app-2.4.0",features:dt,defaultMemoConfig:ft});chrome.scripting.registerContentScripts([{id:`inject-${N}`,js:["injects/proxy.js"],matches:q,runAt:"document_start",world:"MAIN"}]);chrome.scripting.registerContentScripts([{id:`inject-${N}-module`,js:["injects/vendors.js","injects/index.js"],matches:q,runAt:"document_end",world:"MAIN"}]);
